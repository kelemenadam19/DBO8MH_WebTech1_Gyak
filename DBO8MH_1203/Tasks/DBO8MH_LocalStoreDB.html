<!DOCTYPE html>
<html lang="hu">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBO8MH - Web Tech 1 - LocalStorage</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f4;
        }

        .container {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        h2 {
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
            margin-top: 0;
        }

        .form-group {
            margin-bottom: 10px;
        }

        label {
            display: inline-block;
            width: 100px;
            font-weight: bold;
        }

        input,
        select {
            padding: 5px;
            width: 250px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        button {
            padding: 8px 15px;
            cursor: pointer;
            border: none;
            border-radius: 3px;
            color: white;
            margin-right: 5px;
        }

        .btn-green {
            background-color: #5cb85c;
        }

        .btn-blue {
            background-color: #337ab7;
        }

        .btn-red {
            background-color: #d9534f;
        }

        .btn-gray {
            background-color: #efefef;
            color: black;
            border: 1px solid #ccc;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #f9f9f9;
        }

        .controls {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: flex-end;
        }
    </style>
</head>

<body>

    <div class="container">
        <h2>Új hallgató hozzáadása</h2>
        <form id="studentForm">
            <input type="hidden" id="editIndex" value="-1">
            <div class="form-group"><label>Név:</label><input type="text" id="name" placeholder="Név" required></div>
            <div class="form-group"><label>Évfolyam:</label><input type="number" id="year" placeholder="123" required>
            </div>
            <div class="form-group"><label>Szak:</label><input type="text" id="major" placeholder="Szak" required></div>
            <div class="form-group"><label>Email:</label><input type="email" id="email" placeholder="Email" required>
            </div>
            <div class="form-group"><label>NEPTUN kód:</label><input type="text" id="neptun" placeholder="Neptun kód"
                    required>
            </div>
            <button type="submit" class="btn-green">Mentés</button>
            <button type="button" onclick="resetForm()" class="btn-gray">Mégse</button>
        </form>
    </div>

    <div class="container">
        <div class="controls">
            <div class="form-group">
                <label style="display:block">Keresés:</label>
                <input type="text" id="searchInput" placeholder="Név, Neptun, Szak..." onkeyup="renderTable()">
            </div>
            <div class="form-group">
                <label style="display:block">Rendezés:</label>
                <select id="sortSelect" onchange="renderTable()">
                    <option value="none">Nincs rendezés</option>
                    <option value="name_asc">Név (A-Z)</option>
                    <option value="year_asc">Évfolyam (Növekvő)</option>
                </select>
            </div>
            <div class="form-group">
                <label style="display:block">Export / Import JSON</label>
                <button onclick="exportJSON()" class="btn-blue">Export JSON</button>
                <input type="file" id="importFile" accept=".json" style="display:none" onchange="importJSON(this)">
                <button onclick="document.getElementById('importFile').click()" class="btn-gray">Import JSON</button>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>DBO8MH Hallgatók listája</h2>
        <table>
            <thead>
                <tr>
                    <th>Név</th>
                    <th>Évfolyam</th>
                    <th>Szak</th>
                    <th>Email</th>
                    <th>NEPTUN</th>
                    <th>Műveletek</th>
                </tr>
            </thead>
            <tbody id="studentTableBody">
            </tbody>
        </table>
    </div>

    <script>

        const NEPTUN_KEY = 'DBO8MH_Students';
        let students = JSON.parse(localStorage.getItem(NEPTUN_KEY)) || [];

        document.getElementById('studentForm').addEventListener('submit', function (e) {
            e.preventDefault();
            saveStudent();
        });

        renderTable();

        function saveStudent() {
            const index = document.getElementById('editIndex').value;
            const newStudent = {
                name: document.getElementById('name').value,
                year: document.getElementById('year').value,
                major: document.getElementById('major').value,
                email: document.getElementById('email').value,
                neptun: document.getElementById('neptun').value
            };

            if (index === "-1") {
                students.push(newStudent);
            } else {
                students[index] = newStudent;
                document.getElementById('editIndex').value = "-1";
            }

            localStorage.setItem(NEPTUN_KEY, JSON.stringify(students));
            resetForm();
            renderTable();
        }

        function deleteStudent(index) {
            if (confirm("Biztosan törölni szeretné?")) {
                students.splice(index, 1);
                localStorage.setItem(NEPTUN_KEY, JSON.stringify(students));
                renderTable();
            }
        }

        function editStudent(index) {
            const s = students[index];
            document.getElementById('name').value = s.name;
            document.getElementById('year').value = s.year;
            document.getElementById('major').value = s.major;
            document.getElementById('email').value = s.email;
            document.getElementById('neptun').value = s.neptun;
            document.getElementById('editIndex').value = index;
        }

        function resetForm() {
            document.getElementById('studentForm').reset();
            document.getElementById('editIndex').value = "-1";
        }

        function renderTable() {
            const tbody = document.getElementById('studentTableBody');
            const search = document.getElementById('searchInput').value.toLowerCase();
            const sortMode = document.getElementById('sortSelect').value;

            tbody.innerHTML = '';

            let filtered = students.map((s, i) => ({ ...s, originalIndex: i })).filter(s =>
                s.name.toLowerCase().includes(search) ||
                s.neptun.toLowerCase().includes(search) ||
                s.major.toLowerCase().includes(search) ||
                s.email.toLowerCase().includes(search) ||
                s.year.toString().includes(search)
            );

            if (sortMode === 'name_asc') {
                filtered.sort((a, b) => a.name.localeCompare(b.name));
            } else if (sortMode === 'year_asc') {
                filtered.sort((a, b) => a.year - b.year);
            }

            filtered.forEach(s => {
                const row = `<tr>
                    <td>${s.name}</td>
                    <td>${s.year}</td>
                    <td>${s.major}</td>
                    <td>${s.email}</td>
                    <td>${s.neptun}</td>
                    <td>
                        <button class="btn-blue" onclick="editStudent(${s.originalIndex})">Módosít</button>
                        <button class="btn-red" onclick="deleteStudent(${s.originalIndex})">Töröl</button>
                    </td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        function exportJSON() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(students));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "DBO8MH_students.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function importJSON(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const json = JSON.parse(e.target.result);
                    if (Array.isArray(json)) {
                        students = json;
                        localStorage.setItem(NEPTUN_KEY, JSON.stringify(students));
                        renderTable();
                        alert("Sikeres importálás!");
                    }
                } catch (err) {
                    alert("Hiba a JSON fájlban!");
                }
            };
            reader.readAsText(file);
        }
    </script>
</body>

</html>